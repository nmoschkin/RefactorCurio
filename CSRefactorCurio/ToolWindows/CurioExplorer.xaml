<UserControl
    x:Class="CSRefactorCurio.CurioExplorer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:CSRefactorCurio.Controls"
    xmlns:catalog="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.ImageCatalog"
    xmlns:conv="clr-namespace:CSRefactorCurio.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:glob="clr-namespace:CSRefactorCurio.Globalization"
    xmlns:imaging="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.Imaging"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mod="clr-namespace:DataTools.CSTools"
    xmlns:rpt="clr-namespace:CSRefactorCurio.Reporting"
    xmlns:shell="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
    xmlns:sys="mscorlib"
    xmlns:theming="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Imaging"
    xmlns:toolkit="clr-namespace:Community.VisualStudio.Toolkit;assembly=Community.VisualStudio.Toolkit"
    xmlns:util="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Utilities"
    Name="MyToolWindow"
    d:DesignHeight="300"
    d:DesignWidth="300"
    toolkit:Themes.UseVsTheme="True"
    mc:Ignorable="d"
    >
    <Grid Cursor="{Binding Cursor}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <ToolBar
            HorizontalAlignment="Stretch"
            VerticalAlignment="Center"
            Background="Transparent"
            ToolBar.OverflowMode="AsNeeded"
            >
            <ToolBar.Resources>
                <conv:SelectionGroupConverter x:Key="selConv" />
                <!--<Style TargetType="ToggleButton">
                    <Setter Property="Background" Value="Transparent" />
                </Style>-->
            </ToolBar.Resources>

            <ToggleButton
                x:Name="Button1"
                toolkit:Themes.UseVsTheme="True"
                IsChecked="{Binding IsActive1, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                >
                <imaging:CrispImage
                    Width="16"
                    Height="16"
                    Moniker="{x:Static catalog:KnownMonikers.FolderClosed}"
                    />
            </ToggleButton>
            <ToggleButton
                x:Name="Button2"
                toolkit:Themes.UseVsTheme="True"
                IsChecked="{Binding IsActive2, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                >
                <imaging:CrispImage
                    Width="16"
                    Height="16"
                    Moniker="{x:Static catalog:KnownMonikers.Namespace}"
                    />
            </ToggleButton>
            <ToggleButton
                x:Name="Button3"
                toolkit:Themes.UseVsTheme="True"
                IsChecked="{Binding IsActive3, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                >
                <imaging:CrispImage
                    Width="16"
                    Height="16"
                    Moniker="{x:Static catalog:KnownMonikers.TreeMap}"
                    />
            </ToggleButton>

        </ToolBar>

        <TreeView
            Name="ProjTree"
            Grid.Row="1"
            Background="Transparent"
            ItemsSource="{Binding CurrentItems}"
            MouseDoubleClick="ProjTree_MouseDoubleClick"
            SelectedItemChanged="ProjTree_SelectedItemChanged"
            >

            <TreeView.Resources>


                <Style TargetType="ToolTip">
                    <Setter Property="Background" Value="{DynamicResource {x:Static shell:VsBrushes.ToolWindowBackgroundKey}}" />
                </Style>

                <conv:MarkerKindToMonikerConverter x:Key="convMon" />

                <Style
                    x:Key="ExpandingImageStyle"
                    TargetType="{x:Type imaging:CrispImage}"
                    >
                    <Setter Property="Moniker" Value="{x:Static catalog:KnownMonikers.FolderClosed}" />
                    <Style.Triggers>
                        <DataTrigger
                            Binding="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}, Path=IsExpanded}"
                            Value="True"
                            >
                            <Setter Property="Moniker" Value="{x:Static catalog:KnownMonikers.FolderOpened}" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
                <HierarchicalDataTemplate
                    DataType="{x:Type mod:CurioProject}"
                    ItemsSource="{Binding RootFolder.Children}"
                    >
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <imaging:CrispImage
                            Width="16"
                            Margin="2"
                            Moniker="{x:Static catalog:KnownMonikers.CSProjectNode}"
                            />

                        <TextBlock
                            Grid.Column="1"
                            Margin="2"
                            Text="{Binding Title}"
                            />
                    </Grid>
                </HierarchicalDataTemplate>
                <HierarchicalDataTemplate
                    DataType="{x:Type mod:CSNamespace}"
                    ItemsSource="{Binding Children}"
                    >
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <imaging:CrispImage
                            Width="16"
                            Margin="2"
                            Moniker="{x:Static catalog:KnownMonikers.Namespace}"
                            />

                        <TextBlock
                            Grid.Column="1"
                            Margin="2"
                            Text="{Binding Title}"
                            />
                    </Grid>
                </HierarchicalDataTemplate>

                <HierarchicalDataTemplate
                    DataType="{x:Type mod:CSDirectory}"
                    ItemsSource="{Binding Children}"
                    >
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <imaging:CrispImage
                            x:Name="ciFolder"
                            Width="16"
                            Height="16"
                            Margin="2"
                            Style="{StaticResource ExpandingImageStyle}"
                            />

                        <TextBlock
                            Grid.Column="1"
                            Margin="2"
                            Text="{Binding Title}"
                            />
                    </Grid>

                </HierarchicalDataTemplate>

                <HierarchicalDataTemplate
                    DataType="{x:Type mod:CSSolutionFolder}"
                    ItemsSource="{Binding Children}"
                    >
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <imaging:CrispImage
                            x:Name="ciFolder"
                            Width="16"
                            Height="16"
                            Margin="2"
                            Style="{StaticResource ExpandingImageStyle}"
                            />

                        <TextBlock
                            Grid.Column="1"
                            Margin="2"
                            Text="{Binding Title}"
                            />
                    </Grid>

                </HierarchicalDataTemplate>

                <HierarchicalDataTemplate
                    DataType="{x:Type mod:CSCodeFile}"
                    ItemsSource="{Binding FilteredItems}"
                    >
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <imaging:CrispImage
                            Width="16"
                            Height="16"
                            Margin="2"
                            Moniker="{x:Static catalog:KnownMonikers.CSFile}"
                            />

                        <TextBlock
                            Grid.Column="1"
                            Margin="2"
                            Text="{Binding Title}"
                            />
                    </Grid>
                </HierarchicalDataTemplate>
                <HierarchicalDataTemplate
                    DataType="{x:Type rpt:ReportNode}"
                    ItemsSource="{Binding AssociatedList}"
                    >
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <imaging:CrispImage
                            Width="16"
                            Height="16"
                            Margin="2"
                            Moniker="{x:Static catalog:KnownMonikers.SubReport}"
                            />

                        <TextBlock
                            Grid.Column="1"
                            Margin="2"
                            Text="{Binding Title}"
                            />
                    </Grid>
                </HierarchicalDataTemplate>
                <HierarchicalDataTemplate
                    DataType="{x:Type mod:CSMarker}"
                    ItemsSource="{Binding Children}"
                    >
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <imaging:CrispImage
                            Width="16"
                            Height="16"
                            Margin="2"
                            Moniker="{Binding Kind, Converter={StaticResource convMon}}"
                            />

                        <StackPanel
                            Grid.Column="1"
                            Margin="2"
                            HorizontalAlignment="Stretch"
                            Orientation="Horizontal"
                            >

                            <TextBlock
                                Margin="0"
                                Padding="0"
                                Foreground="{conv:ColorPropertyToBrush Key=keyword}"
                                Text="{Binding AccessModifierString}"
                                >
                                <TextBlock.ToolTip>
                                    <ToolTip>
                                        <StackPanel Orientation="Vertical">
                                            <Label Content="{Binding Title}" />
                                            <Label Content="{Binding}" />
                                            <Label Content="{Binding HomeFile}" />
                                            <Label Content="{Binding HomeFile.Project}" />
                                        </StackPanel>
                                    </ToolTip>
                                </TextBlock.ToolTip>
                            </TextBlock>


                            <TextBlock
                                Margin="0"
                                Padding="0"
                                Foreground="{conv:ColorPropertyToBrush Key=type}"
                                Text="{Binding DataTypeString}"
                                >
                                <TextBlock.ToolTip>
                                    <ToolTip>
                                        <StackPanel Orientation="Vertical">
                                            <Label Content="{Binding Title}" />
                                            <Label Content="{Binding}" />
                                            <Label Content="{Binding HomeFile}" />
                                            <Label Content="{Binding HomeFile.Project}" />
                                        </StackPanel>
                                    </ToolTip>
                                </TextBlock.ToolTip>
                            </TextBlock>

                            <TextBlock
                                Margin="0"
                                Padding="0"
                                Foreground="{conv:ColorPropertyToBrush Key=identifier}"
                                Text="{Binding Name}"
                                >
                                <TextBlock.ToolTip>
                                    <ToolTip>
                                        <StackPanel Orientation="Vertical">
                                            <Label Content="{Binding Title}" />
                                            <Label Content="{Binding}" />
                                            <Label Content="{Binding HomeFile}" />
                                            <Label Content="{Binding HomeFile.Project}" />
                                        </StackPanel>
                                    </ToolTip>
                                </TextBlock.ToolTip>
                            </TextBlock>

                            <TextBlock
                                Margin="0"
                                Padding="0"
                                Text="{Binding Generics}"
                                >
                                <TextBlock.ToolTip>
                                    <ToolTip>
                                        <StackPanel Orientation="Vertical">
                                            <Label Content="{Binding Title}" />
                                            <Label Content="{Binding}" />
                                            <Label Content="{Binding HomeFile}" />
                                            <Label Content="{Binding HomeFile.Project}" />
                                        </StackPanel>
                                    </ToolTip>
                                </TextBlock.ToolTip>
                            </TextBlock>

                            <TextBlock
                                Margin="0"
                                Padding="0"
                                Foreground="{conv:ColorPropertyToBrush Key=punctuation}"
                                Text="{Binding MethodParamsString}"
                                >
                                <TextBlock.ToolTip>
                                    <ToolTip>
                                        <StackPanel Orientation="Vertical">
                                            <Label Content="{Binding Title}" />
                                            <Label Content="{Binding}" />
                                            <Label Content="{Binding HomeFile}" />
                                            <Label Content="{Binding HomeFile.Project}" />
                                        </StackPanel>
                                    </ToolTip>
                                </TextBlock.ToolTip>
                            </TextBlock>

                            <TextBlock
                                Margin="0"
                                Padding="0"
                                Foreground="{conv:ColorPropertyToBrush Key=type}"
                                Text="{Binding Inheritance}"
                                >
                                <TextBlock.ToolTip>
                                    <ToolTip>
                                        <StackPanel Orientation="Vertical">
                                            <Label Content="{Binding Title}" />
                                            <Label Content="{Binding}" />
                                            <Label Content="{Binding HomeFile}" />
                                            <Label Content="{Binding HomeFile.Project}" />
                                        </StackPanel>
                                    </ToolTip>
                                </TextBlock.ToolTip>
                            </TextBlock>
                            <TextBlock
                                Margin="0"
                                Padding="0"
                                Foreground="{conv:ColorPropertyToBrush Key=operator}"
                                Text="{Binding WhereClause}"
                                >
                                <TextBlock.ToolTip>
                                    <ToolTip>
                                        <StackPanel Orientation="Vertical">
                                            <Label Content="{Binding Title}" />
                                            <Label Content="{Binding}" />
                                            <Label Content="{Binding HomeFile}" />
                                            <Label Content="{Binding HomeFile.Project}" />
                                        </StackPanel>
                                    </ToolTip>
                                </TextBlock.ToolTip>
                            </TextBlock>

                        </StackPanel>
                    </Grid>
                </HierarchicalDataTemplate>

            </TreeView.Resources>
            <TreeView.ContextMenu>

                <ContextMenu toolkit:Themes.UseVsTheme="True">

                    <ContextMenu.Resources>

                        <Style TargetType="MenuItem">
                            <Setter Property="Background" Value="{DynamicResource {x:Static shell:VsBrushes.MenuKey}}" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Foreground" Value="{DynamicResource {x:Static shell:VsBrushes.MenuTextKey}}" />
                            <Setter Property="Height" Value="24" />
                            <Setter Property="HorizontalAlignment" Value="Stretch" />
                            <Setter Property="HorizontalContentAlignment" Value="Left" />
                            <Setter Property="Margin" Value="0" />
                            <Setter Property="Padding" Value="4,2" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="VerticalContentAlignment" Value="Center" />
                        </Style>
                    </ContextMenu.Resources>


                    <ContextMenu.ItemContainerStyle>
                        <Style TargetType="ItemsControl">
                            <Setter Property="Background" Value="{DynamicResource {x:Static shell:VsBrushes.MenuKey}}" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Margin" Value="0" />
                            <Setter Property="Padding" Value="0" />
                        </Style>
                    </ContextMenu.ItemContainerStyle>
                    <MenuItem
                        toolkit:Themes.UseVsTheme="True"
                        Command="{Binding ClickBuild}"
                        Header="{glob:Translate ResourceKey=MI_BUILD_SOLUTION}"
                        >
                        <MenuItem.Icon>
                            <imaging:CrispImage
                                Width="16"
                                Height="16"
                                Margin="4"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Moniker="{x:Static catalog:KnownMonikers.BuildSolution}"
                                />
                        </MenuItem.Icon>
                    </MenuItem>

                    <MenuItem
                        toolkit:Themes.UseVsTheme="True"
                        Command="{Binding ReportCommand}"
                        Header="{glob:Translate ResourceKey=REPORTS}"
                        >
                        <MenuItem.Icon>
                            <imaging:CrispImage
                                Width="16"
                                Height="16"
                                Margin="4"
                                Moniker="{x:Static catalog:KnownMonikers.Report}"
                                />
                        </MenuItem.Icon>
                    </MenuItem>

                </ContextMenu>
            </TreeView.ContextMenu>
        </TreeView>
    </Grid>
</UserControl>
